<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notificaciones | Gym</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="Style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <img src="images/GymLogo.jpeg" alt="Logo Inventory Athlon" width="40" height="40" class="me-2">
                <span>Inventory Athlon</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-3 me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="Dashboard.html">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Agregar_Productos.html">Agregar Productos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Reservar_Maquinaria.html">Reservar Maquinaria</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Informes.html">Informes</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="Notificaciones.html">Informes facturación/a>
                    </li>
                </ul>
                <button class="btn btn-danger fw-bold">Cerrar Sesión</button>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h2 class="text-center mb-4">Sistema de Notificaciones</h2>
        
        <div class="row">
            <div class="col-md-8 mx-auto">
                <!-- Formulario para crear notificaciones -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        Crear Nueva Notificación
                    </div>
                    <div class="card-body">
                        <form id="notificationForm">
                            <div class="mb-3">
                                <label for="notificationType" class="form-label">Tipo de Notificación</label>
                                <select class="form-select" id="notificationType" required>
                                    <option value="">Seleccione un tipo</option>
                                    <option value="Nueva Maquinaria">Nueva Maquinaria</option>
                                    <option value="Mantenimiento">Mantenimiento Programado</option>
                                    <option value="Avería">Reporte de Avería</option>
                                    <option value="Promoción">Promoción</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="notificationTitle" class="form-label">Título</label>
                                <input type="text" class="form-control" id="notificationTitle" placeholder="Ej: Nueva máquina de cardio disponible" required>
                            </div>
                            <div class="mb-3">
                                <label for="notificationMessage" class="form-label">Mensaje</label>
                                <textarea class="form-control" id="notificationMessage" rows="4" placeholder="Detalles de la notificación" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="notificationAudience" class="form-label">Destinatarios</label>
                                <select class="form-select" id="notificationAudience" required>
                                    <option value="Todos">Todos los usuarios</option>
                                    <option value="Staff">Solo personal</option>
                                    <option value="Miembros">Solo miembros</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="notificationPriority" class="form-label">Prioridad</label>
                                <select class="form-select" id="notificationPriority" required>
                                    <option value="Baja">Baja</option>
                                    <option value="Media" selected>Media</option>
                                    <option value="Alta">Alta</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Enviar Notificación</button>
                        </form>
                    </div>
                </div>
                
                <!-- Historial de notificaciones -->
                <div class="card">
                    <div class="card-header bg-dark text-white">
                        Historial de Notificaciones
                    </div>
                    <div class="card-body p-0">
                        <ul class="list-group list-group-flush" id="notificationHistory">
                            <!-- Las notificaciones se agregarán dinámicamente aquí -->
                        </ul>
                        <div id="emptyNotifications" class="text-center py-4 d-none">
                            <p class="text-muted">No hay notificaciones recientes</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts: primero Bootstrap, luego tu script -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="Inventory.js"></script>
    
    <!-- Script específico para la página de notificaciones -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const notificationForm = document.getElementById('notificationForm');
            const notificationHistory = document.getElementById('notificationHistory');
            const emptyNotifications = document.getElementById('emptyNotifications');
            
            // Obtener notificaciones del localStorage
            let notifications = JSON.parse(localStorage.getItem('notifications')) || [];
            
            // Mostrar notificaciones existentes
            renderNotifications();
            
            // Manejar envío del formulario
            notificationForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Obtener datos del formulario
                const type = document.getElementById('notificationType').value;
                const title = document.getElementById('notificationTitle').value;
                const message = document.getElementById('notificationMessage').value;
                const audience = document.getElementById('notificationAudience').value;
                const priority = document.getElementById('notificationPriority').value;
                
                // Crear objeto de notificación
                const newNotification = {
                    id: Date.now(), // ID único basado en timestamp
                    type,
                    title,
                    message,
                    audience,
                    priority,
                    date: new Date().toISOString(),
                    read: false
                };
                
                // Agregar al principio del array
                notifications.unshift(newNotification);
                
                // Guardar en localStorage
                localStorage.setItem('notifications', JSON.stringify(notifications));
                
                // Actualizar UI
                renderNotifications();
                
                // Resetear formulario
                notificationForm.reset();
                
                // Mostrar alerta de éxito
                alert('Notificación enviada correctamente');
            });
            
            // Función para renderizar las notificaciones
            function renderNotifications() {
                if (notifications.length === 0) {
                    notificationHistory.innerHTML = '';
                    emptyNotifications.classList.remove('d-none');
                    return;
                }
                
                emptyNotifications.classList.add('d-none');
                notificationHistory.innerHTML = '';
                
                notifications.forEach(notification => {
                    // Formatear fecha
                    const date = new Date(notification.date);
                    const formattedDate = date.toLocaleDateString('es-ES', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    // Determinar colores según la prioridad
                    let priorityClass = 'bg-info';
                    if (notification.priority === 'Alta') priorityClass = 'bg-danger';
                    if (notification.priority === 'Media') priorityClass = 'bg-warning';
                    
                    const item = document.createElement('li');
                    item.className = 'list-group-item';
                    item.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-1">${notification.title}</h5>
                            <span class="badge ${priorityClass}">${notification.priority}</span>
                        </div>
                        <p class="mb-1">${notification.message}</p>
                        <div class="d-flex justify-content-between">
                            <small class="text-muted">Enviado: ${formattedDate}</small>
                            <small class="text-muted">Para: ${notification.audience}</small>
                        </div>
                        <div class="mt-2">
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteNotification(${notification.id})">
                                Eliminar
                            </button>
                        </div>
                    `;
                    
                    notificationHistory.appendChild(item);
                });
            }
            
            // Función para eliminar notificación
            window.deleteNotification = function(id) {
                if (confirm('¿Estás seguro de que deseas eliminar esta notificación?')) {
                    notifications = notifications.filter(notif => notif.id !== id);
                    localStorage.setItem('notifications', JSON.stringify(notifications));
                    renderNotifications();
                }
            };
        });
    </script>
</body>
</html>